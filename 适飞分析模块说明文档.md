# 适飞分析模块说明文档

## 一、核心功能

- **适飞状态可视化**：通过热力图直观展示未来3小时内各气象因素的适飞状态
- **多因素分析**：同时监测综合、风、风切变、颠簸指数、湍流、降水、能见度等7项关键气象指标
- **时间序列预测**：以10分钟为间隔，共19个时间点的精细化预测
- **异常值标注**：在不适飞时段显示具体的异常数值，便于分析原因
- **监测点适配**：支持不同监测点的数据切换和实时更新

## 二、API 接口文档

### 获取监测点适飞分析数据

**接口信息**

- **接口名称**：/weather/weather-suitability
- **功能描述**：获取指定监测点、时间间隔、总长、气象因素未来3小时的适飞分析数据
- **请求方式**：POST

**请求参数**

|名称|位置|类型|必选|说明|
|---|---|---|---|---|
|pointId|query|string| 是 |none|
|timeInterval|query|integer| 是 |时间间隔（分钟），需为正整数	|
|totalHours|query|integer| 是 |总时长（小时），需为正整数	|
|factors|query|array[string]| 否 |需返回的气象因素列表（可选，默认返回全部[' 综合 ', ' 风 ', ' 风切变 ', ' 颠簸指数 ', ' 湍流 ', ' 降水 ', ' 能见度 ']）	|

**返回数据结构**

```javascript
{
  "factors": ["综合", "风", "风切变", "颠簸指数", "湍流", "降水", "能见度"], // 气象因素列表
  "timeInterval": 10, // 时间间隔（分钟）
  "totalHours": 3, // 预测总时长（小时）
  "timePoints": [ // 时间点列表，ISO格式
    "2025-11-17 10:00",
    "2025-11-17 10:10",
    // ... 共19个时间点
  ],
  "statusData": [ // 适飞状态矩阵（7×19），true=适飞，false=不适飞
    // 综合适飞状态
    [true, true, false, false, false, true, true, true, false, false, true, true, false, true, true, false, false, true, true],
    // 风适飞状态
    [true, true, false, false, true, true, true, false, false, true, true, true, true, false, false, true, true, true, false],
    // 风切变适飞状态
    [true, false, false, true, true, true, false, false, true, true, true, true, false, false, true, true, true, false, true],
    // 颠簸指数适飞状态
    [true, true, true, false, false, true, true, true, true, false, false, true, true, true, false, false, true, true, false],
    // 湍流适飞状态（全适飞）
    [true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true],
    // 降水适飞状态（全适飞）
    [true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true],
    // 能见度适飞状态（全适飞）
    [true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true]
  ],
  "valueData": [ // 异常值矩阵（7×19），非空字符串表示异常值
    // 综合（无具体值）
    ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
    // 风异常值
    ["", "", "9m/s", "9m/s", "", "", "", "8m/s", "8m/s", "", "", "", "9m/s", "", "", "8m/s", "8m/s", "", "9m/s"],
    // 风切变异常值
    ["", "7m/s", "7m/s", "", "", "", "6m/s", "6m/s", "", "", "", "7m/s", "7m/s", "6m/s", "", "", "", "6m/s", "7m/s"],
    // 颠簸指数异常值
    ["", "", "", "中", "中", "", "", "", "", "中", "中", "", "", "", "中", "中", "", "", "中"],
    // 湍流（无异常值）
    ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
    // 降水（无异常值）
    ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
    // 能见度（无异常值）
    ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]
  ]
}
```

## 三、数据结构说明

### 1. 适飞状态判断标准

- **综合适飞状态**：综合所有气象因素，只要有任一因素不适飞，则综合状态为不适飞
- **风适飞状态**：风速>8m/s时判定为不适飞
- **风切变适飞状态**：风切变>6m/s时判定为不适飞
- **颠簸指数适飞状态**：颠簸指数为"中"或"高"时判定为不适飞
- **湍流适飞状态**：当前始终为适飞（后续可扩展）
- **降水适飞状态**：当前始终为适飞（后续可扩展）
- **能见度适飞状态**：当前始终为适飞（后续可扩展）

### 2. 数据更新频率

- **数据更新周期**：建议每5分钟更新一次预测数据
- **历史数据保存**：建议保存最近24小时的历史预测数据，用于对比分析

### 3. 数据质量控制

- **异常值处理**：当检测到异常数据时，系统会使用上一次有效预测结果
- **数据有效性**：当预测数据超过10分钟未更新时，会标记为数据过期
- **边界值处理**：当风速、风切变等指标接近阈值时，会在valueData中特殊标记

## 四、界面交互说明

### 1. 热力图展示

- **色彩编码**：绿色表示适飞，红色表示不适飞
- **网格结构**：7行（气象因素）×19列（时间点）的网格布局
- **标签显示**：时间标签（每10分钟）和气象因素标签清晰可见
- **异常值标注**：在不适飞的网格中显示具体的异常数值

### 2. 交互功能

- **鼠标悬停**：鼠标悬停在任意网格上时，显示详细信息（因素名称、时间、状态、异常值）
- **监测点切换**：当用户切换监测点时，图表数据会自动刷新
- **响应式调整**：窗口大小变化时，图表会自动调整大小以适应显示区域
- **时间标签优化**：为避免文字重叠，时间标签旋转45度，并只显示整点和半点

### 3. 状态提示

- **数据加载状态**：加载数据时显示加载指示器
- **数据过期提示**：当数据超过10分钟未更新时，显示数据过期警告
- **监测点选择提示**：未选择监测点时，提示用户先选择监测点
- **异常情况提示**：API调用失败时，显示错误信息并提供重试选项
